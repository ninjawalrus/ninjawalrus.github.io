function TextModeScreen(e,t,r,n){var a=document.getElementById(r);if(!a)return void alert("Failed to find canvas");if(this.context2d=a.getContext("2d"),!this.context2d)return void alert("Couldn't get 2d context on canvas");for(a.width=16*e,a.height=24*t,this.charsWide=e,this.charsHigh=t,this.charBuffer=new Uint8Array(e*t),this.colourBuffer=new Uint8Array(e*t),this.colouredFonts=new Array(16),i=0;i<16;i++){this.colouredFonts[i]=document.createElement("canvas"),this.colouredFonts[i].width=n.width,this.colouredFonts[i].height=n.height;var o=this.colouredFonts[i].getContext("2d");o.fillStyle=colourTable[i],o.fillRect(0,0,n.width,n.height),o.globalCompositeOperation="destination-atop",o.drawImage(n,0,0)}}function init(){screenManager=new TextModeScreen(60,25,"canvas",sourceFont),setInterval(mainLoop,40),lastUpdate=(new Date).getTime()}function mainLoop(){var e=(new Date).getTime(),t=e-lastUpdate,r=!1;if(t>250){lastUpdate=(new Date).getTime(),r=!0;var n=text.split(""),a=n.shift();n.push(a),text=n.join("")}var o=0;for(y=0;y<screenManager.charsHigh;y++)for(x=0;x<screenManager.charsWide;x++)screenManager.charBuffer[o]=255*Math.random(),screenManager.colourBuffer[o]=17,o++;if(r){var i=Math.floor(11*Math.random());for(splosionsPx=[],h=0;i>h;h++){var s=Math.floor(Math.random()*(screenManager.charsHigh*screenManager.charsWide));splosionsPx.push(s)}}for(h=0;h<splosionsPx.length;h++)screenManager.colourBuffer[splosionsPx[h]]=31;var c=[76,100,239,162,93];y=8;for(var h=0;h<c.length;h++)for(var d=0;2>d;d++){var p=0;for(x=0;x<screenManager.charsWide-14;x++){var u=Math.round(Math.sin(x/3+e/80)),f=(y+u)*screenManager.charsWide+x;screenManager.colourBuffer[f]=c[h],p++}y++}var g=Math.round(Math.cos(e/100)-.25),l=Math.round(Math.sin(e/100)-.25),M=Math.round(Math.cos(e/100)-.25),v=Math.round(Math.sin(e/100)-.25),B=Math.round(Math.cos(e/100)-.5),F=Math.round(Math.sin(e/100)-.5);printLeg(42+g,16+l),printLeg(34+g,16+l),printLeg(26+g,16+l),printLeg(20+g,16+l),printTail(12+M,11+v),printCatBody(19+M,5+v),printCatHead(42+B,8+F),screenManager.processBox(screenManager.charsWide-23,21,22,3,function(e,t){return[e,119&t]}),screenManager.printBox(screenManager.charsWide-23,21,22,3,127),screenManager.print(screenManager.charsWide-22,22,text,127),screenManager.presentToScreen()}function printCatBody(e,t){screenManager.printBox(e+1,t,26,1,0),screenManager.printBox(e,t+1,28,10,0),screenManager.printBox(e+1,t+11,26,1,0),screenManager.printBox(e+1,t+1,26,10,119),screenManager.printBox(e+2,t+2,24,8,221);for(var r=[[e+20,t+3],[e+12,t+4],[e+3,t+3],[e+11,t+8],[e+16,t+6],[e+6,t+6],[e+3,t+8],[e+12,t+4],[e+20,t+8]],n=0;n<r.length;n++){var a=r[n][0],o=r[n][1],i=o*screenManager.charsWide+a;screenManager.charBuffer[i]=255*Math.random(),screenManager.colourBuffer[i]=220}}function printTail(e,t){var r=e+7,n=e,a=(new Date).getTime();for(e;r>e;e++)for(var o=-Math.round(Math.sin(e/3+a/80)),i=0;4>i;i++){var s=t+i,c=(s+o)*screenManager.charsWide+e;i>0&&3>i&&e!=n?screenManager.colourBuffer[c]=119:screenManager.colourBuffer[c]=0}}function printCatHead(e,t){printEar(e,t),printEar(e+11,t),printFace(e-2,t+2)}function printLeg(e,t){screenManager.printBox(e,t,5,3,0),screenManager.printBox(e+1,t,3,2,119)}function printFace(e,t){screenManager.printBox(e,t,19,5,0),screenManager.printBox(e+1,t,17,5,119),screenManager.printBox(e+1,t+5,17,1,0),screenManager.printBox(e+2,t+5,15,1,119),screenManager.printBox(e+1,t+6,17,1,0),screenManager.printBox(e+4,t+1,1,1,0),screenManager.printBox(e+12,t+1,1,1,0),screenManager.printBox(e+2,t+3,1,1,204),screenManager.printBox(e+15,t+3,1,1,204),screenManager.printBox(e+8,t+3,1,1,0),screenManager.printBox(e+5,t+4,9,1,0)}function printEar(e,t){screenManager.printBox(e,t,4,1,0),screenManager.printBox(e-1,t+1,6,1,0),screenManager.printBox(e+1,t+1,3,1,119)}var Status=function(e){var t={addEvent:function(e,t,r,n){e.addEventListener?e.addEventListener(t,r,!1):e.attachEvent&&(e["e"+t+r]=r,e[t+r]=function(){e["e"+t+r](window.event,n)},e.attachEvent("on"+t,e[t+r]))},input:"",pattern:"38384040373937396665",load:function(e){this.addEvent(document,"keydown",function(r,n){return n&&(t=n),t.input+=r?r.keyCode:event.keyCode,t.input.length>t.pattern.length&&(t.input=t.input.substr(t.input.length-t.pattern.length)),t.input==t.pattern?(t.code(e),t.input="",r.preventDefault(),!1):void 0},this),this.iphone.load(e)},code:function(e){window.location=e},iphone:{start_x:0,start_y:0,stop_x:0,stop_y:0,tap:!1,capture:!1,orig_keys:"",keys:["UP","UP","DOWN","DOWN","LEFT","RIGHT","LEFT","RIGHT","TAP","TAP"],code:function(e){t.code(e)},load:function(e){this.orig_keys=this.keys,t.addEvent(document,"touchmove",function(e){if(1==e.touches.length&&1==t.iphone.capture){var r=e.touches[0];t.iphone.stop_x=r.pageX,t.iphone.stop_y=r.pageY,t.iphone.tap=!1,t.iphone.capture=!1,t.iphone.check_direction()}}),t.addEvent(document,"touchend",function(r){1==t.iphone.tap&&t.iphone.check_direction(e)},!1),t.addEvent(document,"touchstart",function(e){t.iphone.start_x=e.changedTouches[0].pageX,t.iphone.start_y=e.changedTouches[0].pageY,t.iphone.tap=!0,t.iphone.capture=!0})},check_direction:function(e){x_magnitude=Math.abs(this.start_x-this.stop_x),y_magnitude=Math.abs(this.start_y-this.stop_y),x=this.start_x-this.stop_x<0?"RIGHT":"LEFT",y=this.start_y-this.stop_y<0?"DOWN":"UP",result=x_magnitude>y_magnitude?x:y,result=1==this.tap?"TAP":result,result==this.keys[0]&&(this.keys=this.keys.slice(1,this.keys.length)),0==this.keys.length&&(this.keys=this.orig_keys,this.code(e))}}};return"string"==typeof e&&t.load(e),"function"==typeof e&&(t.code=e,t.load()),t},colourTable=["#000000","#0000AA","#00AA00","#00AAAA","#AA0000","#AA00AA","#AA5500","#AAAAAA","#555555","#5555FF","#55FF55","#55FFFF","#FF5555","#FF55FF","#FFFF55","#FFFFFF"];TextModeScreen.prototype.presentToScreen=function(){var e=0,t=0;for(y=0;y<this.charsHigh;y++){var r=0;for(x=0;x<this.charsWide;x++){var n=this.charBuffer[e],a=this.colourBuffer[e];e++;var o=16*(15&n),i=24*(n>>4);this.context2d.fillStyle=colourTable[a>>4],this.context2d.fillRect(r,t,16,24),this.context2d.drawImage(this.colouredFonts[15&a],o,i,16,24,r,t,16,24),r+=16}t+=24}},TextModeScreen.prototype.print=function(e,t,r,n){if(t>=0&&t<this.charsHigh){var a=e+t*this.charsWide;for(i=0;i<r.length;i++)e+i>=0&&e+i<this.charsWide&&(this.charBuffer[a]=r.charCodeAt(i),this.colourBuffer[a]=n),a++}},TextModeScreen.prototype.printBox=function(e,t,r,n,a){var o=r-2;for(this.print(e,t,String.fromCharCode(201)+Array(o+1).join(String.fromCharCode(205))+String.fromCharCode(187),a),j=t+1;j<t+n-1;j++)this.print(e,j,String.fromCharCode(186)+Array(o+1).join(" ")+String.fromCharCode(186),a);this.print(e,t+n-1,String.fromCharCode(200)+Array(o+1).join(String.fromCharCode(205))+String.fromCharCode(188),a)},TextModeScreen.prototype.processBox=function(e,t,r,n,a){for(sy=t;sy<t+n;sy++)if(sy>=0&&sy<=this.charsHigh){var o=e+sy*this.charsWide;for(sx=e;sx<e+r;sx++){if(sx>=0&&sx<=this.charsWide){var i=this.charBuffer[o],s=this.colourBuffer[o],c=a(i,s);this.charBuffer[o]=c[0],this.colourBuffer[o]=c[1]}o++}}};var screenManager,sourceFont=new Image;sourceFont.src="img/font.png";var lastUpdate,splosionsPx=[],text="Nyan Nyan Nyan Nyan ";new Status(function(){init()});